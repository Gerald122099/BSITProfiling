<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" type="x-icon" href="drawable/logo.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="dashboard.css">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- FullCalendar CSS and JS -->
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.4/main.min.css' rel='stylesheet' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.4/main.min.js'></script>
</head>
<body>

    <div class="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo-container">
                <img src="logo.png" alt="Bottle Cycle Logo" class="logo">
                <div class="brand-info">
                    <h1>BOTTLE CYCLE</h1>
                    <p>Smart Arduino Based Plastic Bottle Bin</p>
                </div>
            </div>
            <nav>
                <ul class="nav-links">
                    <li><a href="#"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                    <li><a href="#"><i class="fas fa-bell"></i> Notifications</a></li>
                    <li><a href="#"><i class="fas fa-user"></i> Profile</a></li>
                    <li><a href="#"><i class="fas fa-trash-alt"></i> Bottle Bin</a></li>
                    <li><a href="reports.html"><i class="fas fa-file-alt"></i> Reports</a></li>
                    <li><a href="logout.php"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="content">
           <!-- Reports Section -->
<section class="widget report-widget">
    <h4>Daily Bottle Collection Report</h4>
    <div id="report-table-container">
        <table id="report-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Total Small Bottles</th>
                    <th>Total Medium Bottles</th>
                    <th>Total Large Bottles</th>
                </tr>
            </thead>
            <tbody id="report-table-body">
                <!-- Rows will be populated by JavaScript -->
            </tbody>
        </table>
    </div>
    <div>
        <canvas id="report-chart" width="400" height="200"></canvas>
    </div>
</section>

<!-- Link to Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        </main>
    </div>
    <script>
        // Function to fetch daily report data
        function fetchDailyReport() {
            fetch('get_daily_report.php')
                .then(response => response.json())
                .then(data => {
                    populateReportTable(data);
                    renderReportChart(data);
                })
                .catch(error => console.error('Error fetching daily report:', error));
        }
    
        // Populate report table with data
        function populateReportTable(data) {
            const tableBody = document.getElementById('report-table-body');
            tableBody.innerHTML = '';  // Clear previous rows
    
            data.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.date}</td>
                    <td>${row.small_bottles}</td>
                    <td>${row.medium_bottles}</td>
                    <td>${row.large_bottles}</td>
                `;
                tableBody.appendChild(tr);
            });
        }
    
        // Render chart with report data
        function renderReportChart(data) {
            const dates = data.map(row => row.date);
            const smallBottles = data.map(row => row.small_bottles);
            const mediumBottles = data.map(row => row.medium_bottles);
            const largeBottles = data.map(row => row.large_bottles);
    
            const ctx = document.getElementById('report-chart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dates,
                    datasets: [
                        {
                            label: 'Small Bottles',
                            data: smallBottles,
                            backgroundColor: 'rgba(75, 192, 192, 0.6)',
                        },
                        {
                            label: 'Medium Bottles',
                            data: mediumBottles,
                            backgroundColor: 'rgba(153, 102, 255, 0.6)',
                        },
                        {
                            label: 'Large Bottles',
                            data: largeBottles,
                            backgroundColor: 'rgba(255, 159, 64, 0.6)',
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: { title: { display: true, text: 'Date' } },
                        y: { title: { display: true, text: 'Bottles Collected' } }
                    }
                }
            });
        }
    
        // Fetch report data immediately when the page loads
        fetchDailyReport();
    </script>
    
    
</body>
</html>
